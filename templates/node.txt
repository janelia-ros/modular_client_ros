#!/usr/bin/env python

from __future__ import division, print_function
import rospy
from std_msgs.msg import String
from modular_client_ros.srv import *

from modular_client import ModularClient


dev = ModularClient()

{% for function in functions %}
def handle_{{ function['service_name']}}(request):
    response = dev.{{ function['service_name']}}({% for parameter in function['parameters'] %}request.{{ parameter['name'] }},{% endfor %})
{% if function['result_info'] is defined %}
    return {{ function['service_class'] }}Response(response)
{% else %}
    return {{ function['service_class'] }}Response()
{% endif %}
{% endfor %}

def {{ node_name }}():
    rospy.init_node('{{ node_name }}')

{% for function in functions %}
    rospy.Service('~{{ function["firmware_name"] }}/{{ function["service_name"] }}', {{ function['service_class'] }}, handle_{{ function['service_name']}})
{% endfor %}

    print("{{ node_name }} running.")
    rospy.spin()

if __name__ == "__main__":
    {{ node_name }}()

